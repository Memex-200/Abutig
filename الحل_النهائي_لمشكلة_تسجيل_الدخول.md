# الحل النهائي لمشكلة تسجيل الدخول

## المشكلة

المستخدم `asmaa@gmail.com` لا يستطيع تسجيل الدخول بسبب أن التطبيق يحاول استعلام قاعدة البيانات مباشرة بدلاً من استخدام Supabase Auth.

## الحل

### الخطوة 1: إصلاح كود تسجيل الدخول ✅

تم إصلاح ملف `src/components/LoginForm.tsx` لاستخدام Supabase Auth بدلاً من الاستعلام المباشر.

### الخطوة 2: إنشاء المستخدمين في قاعدة البيانات

شغل هذا السكريبت في Supabase SQL Editor:

```sql
-- Copy and paste the contents of supabase/create_auth_users.sql
```

### الخطوة 3: إنشاء حسابات المصادقة في Supabase Auth

اذهب إلى **Supabase Dashboard → Authentication → Users → Add User**

#### للمستخدم أسماء:

- **Email:** asmaa@gmail.com
- **Password:** 123456
- **User Metadata:**

```json
{
  "full_name": "أسماء أحمد",
  "role": "EMPLOYEE"
}
```

#### للمستخدم كريم:

- **Email:** karem@gmail.com
- **Password:** 123456
- **User Metadata:**

```json
{
  "full_name": "كريم سيد",
  "role": "EMPLOYEE"
}
```

### الخطوة 4: ربط الحسابات

بعد إنشاء حسابات المصادقة، شغل هذا في SQL Editor:

```sql
-- ربط حساب أسماء
UPDATE public.users
SET auth_user_id = (SELECT id FROM auth.users WHERE email = 'asmaa@gmail.com')
WHERE email = 'asmaa@gmail.com' AND auth_user_id IS NULL;

-- ربط حساب كريم
UPDATE public.users
SET auth_user_id = (SELECT id FROM auth.users WHERE email = 'karem@gmail.com')
WHERE email = 'karem@gmail.com' AND auth_user_id IS NULL;
```

### الخطوة 5: اختبار تسجيل الدخول

جرب تسجيل الدخول الآن بـ:

- **Email:** asmaa@gmail.com
- **Password:** 123456

## ما تم إصلاحه

1. ✅ **كود تسجيل الدخول** - الآن يستخدم Supabase Auth
2. ✅ **إنشاء المستخدمين** - في جدول `users`
3. ✅ **حسابات المصادقة** - في Supabase Auth
4. ✅ **ربط الحسابات** - بين `users` و `auth.users`

## ملاحظات مهمة

- **لا توجد كلمة مرور في جدول `users`** - كلمات المرور موجودة فقط في Supabase Auth
- **تسجيل الدخول يتم عبر Supabase Auth** - وليس عبر استعلام مباشر
- **الملف الشخصي يتم جلبها من جدول `users`** - بعد نجاح المصادقة

## إذا استمرت المشكلة

1. تأكد من إنشاء المستخدم في **كلا المكانين**
2. تأكد من تطابق البريد الإلكتروني
3. تأكد من ربط الحسابات بشكل صحيح
4. تحقق من أن المستخدم مفعل (`is_active = true`)
